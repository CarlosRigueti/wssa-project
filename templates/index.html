<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Top Spotify Tracks</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body>
  <div class="container mt-4">

    <h1 class="mb-4 text-center text-success">Top Spotify Tracks</h1>

    <!-- Search form -->
    <form id="searchForm" class="d-flex justify-content-center mb-3" onsubmit="event.preventDefault(); loadTracks();">
      <input
        type="text"
        id="searchInput"
        class="form-control w-50 me-2"
        placeholder="Search by artist name"
      />
      <button class="btn btn-primary" type="submit">Search</button>
    </form>

    <!-- Tracks Table -->
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>Name</th>
          <th>Artist</th>
          <th>Album</th>
          <th>Release Date</th>
          <th>Popularity</th>
          <th>Duration (min)</th>
          <th>Link</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="tracksTableBody"></tbody>
    </table>

    <!-- Pagination -->
    <nav>
      <ul class="pagination justify-content-center" id="pagination"></ul>
    </nav>

  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    let tracks = [];
    const rowsPerPage = 5;
    let currentPage = 1;

    async function loadTracks(page = 1) {
      currentPage = page;
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();

      // Fetch all tracks from your API
      const response = await fetch('/api/tracks');
      tracks = await response.json();

      // Filter by artist name if search term entered
      const filtered = searchTerm
        ? tracks.filter(t => t.artist_name.toLowerCase().includes(searchTerm))
        : tracks;

      renderTable(filtered, page);
      renderPagination(filtered.length, page);
    }

    function renderTable(data, page) {
      const tbody = document.getElementById('tracksTableBody');
      tbody.innerHTML = '';

      const start = (page - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageData = data.slice(start, end);

      pageData.forEach(track => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${track.track_name}</td>
          <td>${track.artist_name}</td>
          <td>${track.album_name || ''}</td>
          <td>${track.release_date || ''}</td>
          <td>${track.popularity || ''}</td>
          <td>${track.duration_min ? track.duration_min.toFixed(2) : ''}</td>
          <td><a href="${track.preview_url || '#'}" target="_blank" class="btn btn-sm btn-success">Play</a></td>
          <td>
            <button class="btn btn-sm btn-primary me-1" onclick="editTrack(${track.id})">Update</button>
            <button class="btn btn-sm btn-danger" onclick="deleteTrack(${track.id})">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      if (pageData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center">No tracks found.</td></tr>';
      }
    }

    function renderPagination(totalItems, currentPage) {
      const totalPages = Math.ceil(totalItems / rowsPerPage);
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';

      for(let i = 1; i <= totalPages; i++) {
        const li = document.createElement('li');
        li.className = `page-item ${i === currentPage ? 'active' : ''}`;
        li.innerHTML = `<a href="#" class="page-link">${i}</a>`;
        li.addEventListener('click', (e) => {
          e.preventDefault();
          loadTracks(i);
        });
        pagination.appendChild(li);
      }
    }

    function editTrack(id) {
      alert('Implement edit for track ID: ' + id);
      // Your edit logic here
    }

    function deleteTrack(id) {
      if (confirm('Are you sure you want to delete this track?')) {
        alert('Implement delete for track ID: ' + id);
        // Your delete logic here
      }
    }

    // Initial load
    loadTracks();
  </script>
</body>
</html>
